@model InternalTalentManagement.Models.ApplicationUser
@{
    ViewData["Title"] = "Mi Perfil";
}

<h1>Mi Perfil</h1>

<div class="card">
    <div class="card-header">
        <h3>Información Personal</h3>
    </div>
    <div class="card-body">
        <div class="info-row">
            <div class="info-item">
                <label>Nombre Completo</label>
                <span>@Model.FirstName @Model.LastName</span>
            </div>
            <div class="info-item">
                <label>Email</label>
                <span>@Model.Email</span>
            </div>
            <div class="info-item">
                <label>Departamento</label>
                <span>@Model.Department</span>
            </div>
            <div class="info-item">
                <label>Posición</label>
                <span>@Model.Position</span>
            </div>
            <div class="info-item">
                <label>Fecha de Contratación</label>
                <span>@Model.HireDate.ToString("dd/MM/yyyy")</span>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Mis Objetivos</h3>
        <button class="btn btn-sm" onclick="document.getElementById('newObjectiveForm').style.display='block'">+ Agregar Objetivo</button>
    </div>
    <div class="card-body">
        <form id="newObjectiveForm" method="post" asp-action="CreateObjective" style="display:none; margin-bottom:20px; padding:15px; background:#f8f9fa; border-radius:8px;">
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label>Título</label>
                <input name="Title" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Descripción</label>
                <textarea name="Description" class="form-control" required></textarea>
            </div>
            <div class="form-group">
                <label>Fecha Objetivo</label>
                <input name="TargetDate" type="date" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-success btn-sm">Guardar</button>
            <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('newObjectiveForm').style.display='none'">Cancelar</button>
        </form>

        @foreach (var objective in Model.Objectives.OrderByDescending(o => o.CreatedAt))
        {
            <div class="card" style="margin-bottom:15px;">
                <h4>@objective.Title</h4>
                <p>@objective.Description</p>
                <p><strong>Estado:</strong> <span class="badge @(objective.Status == ObjectiveStatus.Completed ? "badge-success" : "")">@objective.Status</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: @objective.CompletionPercentage%">@objective.CompletionPercentage%</div>
                </div>
                <p style="margin-top:10px;"><small>Fecha objetivo: @objective.TargetDate.ToString("dd/MM/yyyy")</small></p>
                
                @if (objective.ProgressUpdates.Any())
                {
                    <details style="margin-top:10px;">
                        <summary><strong>Actualizaciones de Progreso</strong></summary>
                        @foreach (var progress in objective.ProgressUpdates.OrderByDescending(p => p.UpdatedAt))
                        {
                            <div style="padding:10px; background:#f8f9fa; margin:5px 0; border-radius:4px;">
                                <p><strong>@progress.UpdatedAt.ToString("dd/MM/yyyy HH:mm")</strong> - Progreso: @progress.ProgressPercentage%</p>
                                <p>@progress.Notes</p>
                            </div>
                        }
                    </details>
                }
            </div>
        }
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Mis Logros</h3>
        <button class="btn btn-sm" onclick="document.getElementById('newAchievementForm').style.display='block'">+ Agregar Logro</button>
    </div>
    <div class="card-body">
        <form id="newAchievementForm" method="post" asp-action="CreateAchievement" style="display:none; margin-bottom:20px; padding:15px; background:#f8f9fa; border-radius:8px;">
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label>Título</label>
                <input name="Title" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Descripción</label>
                <textarea name="Description" class="form-control" required></textarea>
            </div>
            <div class="form-group">
                <label>Categoría</label>
                <input name="Category" class="form-control" placeholder="Ej: Proyecto, Innovación, Liderazgo" />
            </div>
            <div class="form-group">
                <label>Impacto (1-10)</label>
                <input name="ImpactScore" type="number" min="1" max="10" value="5" class="form-control" />
            </div>
            <div class="form-group">
                <label>Fecha</label>
                <input name="AchievedDate" type="date" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-success btn-sm">Guardar</button>
            <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('newAchievementForm').style.display='none'">Cancelar</button>
        </form>

        <div class="grid">
            @foreach (var achievement in Model.Achievements.OrderByDescending(a => a.AchievedDate))
            {
                <div class="card">
                    <h4>@achievement.Title</h4>
                    <p>@achievement.Description</p>
                    <p><span class="badge">@achievement.Category</span> | Impacto: @achievement.ImpactScore/10</p>
                    <p><small>@achievement.AchievedDate.ToString("dd/MM/yyyy")</small></p>
                </div>
            }
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Mis Certificados</h3>
        <button class="btn btn-sm" onclick="document.getElementById('newCertificateForm').style.display='block'">+ Agregar Certificado</button>
    </div>
    <div class="card-body">
        <form id="newCertificateForm" method="post" asp-action="CreateCertificate" enctype="multipart/form-data" style="display:none; margin-bottom:20px; padding:15px; background:#f8f9fa; border-radius:8px;">
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label>Nombre del Certificado</label>
                <input name="Name" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Organización Emisora</label>
                <input name="IssuingOrganization" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Fecha de Emisión</label>
                <input name="IssueDate" type="date" class="form-control" required />
            </div>
            <div class="form-group">
                <label>Fecha de Expiración (opcional)</label>
                <input name="ExpirationDate" type="date" class="form-control" />
            </div>
            <div class="form-group">
                <label>ID de Credencial (opcional)</label>
                <input name="CredentialId" class="form-control" />
            </div>
            <div class="form-group">
                <label>Archivo PDF (opcional)</label>
                <input name="file" type="file" class="form-control" accept=".pdf" />
            </div>
            <button type="submit" class="btn btn-success btn-sm">Guardar</button>
            <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('newCertificateForm').style.display='none'">Cancelar</button>
        </form>

        <div class="grid">
            @foreach (var cert in Model.Certificates.OrderByDescending(c => c.IssueDate))
            {
                <div class="card">
                    <h4>@cert.Name</h4>
                    <p><strong>@cert.IssuingOrganization</strong></p>
                    <p>Emitido: @cert.IssueDate.ToString("dd/MM/yyyy")</p>
                    @if (cert.ExpirationDate.HasValue)
                    {
                        <p>Expira: @cert.ExpirationDate.Value.ToString("dd/MM/yyyy")</p>
                    }
                    @if (!string.IsNullOrEmpty(cert.FileUrl))
                    {
                        <a href="@cert.FileUrl" target="_blank" class="btn btn-sm">Ver Certificado</a>
                    }
                </div>
            }
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Mis Evaluaciones de Desempeño</h3>
    </div>
    <div class="card-body">
        @if (!Model.ReviewsReceived.Any())
        {
            <p>No tienes evaluaciones de desempeño aún.</p>
        }
        else
        {
            @foreach (var review in Model.ReviewsReceived.OrderByDescending(r => r.ReviewDate))
            {
                <div class="card">
                    <h4>Periodo: @review.Period</h4>
                    <p>Fecha: @review.ReviewDate.ToString("dd/MM/yyyy")</p>
                    <p><strong>Puntuación General:</strong> @review.OverallScore.ToString("F2")/5.0</p>
                    <div class="info-row">
                        <div class="info-item">
                            <label>Habilidades Técnicas</label>
                            <span>@review.TechnicalSkillsRating/5</span>
                        </div>
                        <div class="info-item">
                            <label>Trabajo en Equipo</label>
                            <span>@review.TeamworkRating/5</span>
                        </div>
                        <div class="info-item">
                            <label>Liderazgo</label>
                            <span>@review.LeadershipRating/5</span>
                        </div>
                        <div class="info-item">
                            <label>Comunicación</label>
                            <span>@review.CommunicationRating/5</span>
                        </div>
                        <div class="info-item">
                            <label>Iniciativa</label>
                            <span>@review.InitiativeRating/5</span>
                        </div>
                        <div class="info-item">
                            <label>Productividad</label>
                            <span>@review.ProductivityRating/5</span>
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(review.SupervisorComments))
                    {
                        <p><strong>Comentarios:</strong> @review.SupervisorComments</p>
                    }
                </div>
            }
        }
    </div>
</div>
